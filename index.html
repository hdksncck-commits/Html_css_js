<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تطبيق القرآن الكريم الشامل</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1da1f2; /* لون عصري */
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --accent: #10b981;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0; padding: 0;
            overflow-x: hidden;
        }

        /* الهيدر */
        header {
            padding: 20px;
            background: linear-gradient(to bottom, #1e293b, var(--bg-dark));
            text-align: center;
            position: sticky; top: 0; z-index: 100;
        }

        .search-container { padding: 0 15px; margin-top: -10px; }
        .search-input {
            width: 100%; padding: 12px 20px;
            border-radius: 25px; border: none;
            background: var(--card-bg); color: white;
            font-family: 'Cairo'; outline: none;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        /* المحتوى الرئيسي */
        .content-area { padding: 15px; min-height: 80vh; }
        .section-title { font-weight: 600; margin-bottom: 15px; color: var(--accent); }

        /* البطاقات */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .item-card {
            background: var(--card-bg);
            padding: 15px; border-radius: 15px;
            text-align: center; transition: 0.3s;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .item-card:active { transform: scale(0.95); background: #334155; }
        .item-card i { font-size: 24px; display: block; margin-bottom: 8px; }
        .item-name { font-size: 14px; font-weight: 600; }
        .item-sub { font-size: 11px; color: var(--text-dim); margin-top: 4px; }

        /* مشغل الصوت العائم */
        .audio-player-fixed {
            position: fixed; bottom: 70px; left: 10px; right: 10px;
            background: var(--primary);
            border-radius: 15px; padding: 12px;
            display: flex; align-items: center; gap: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            z-index: 999; display: none;
        }

        .player-info { flex: 1; font-size: 12px; }
        audio { display: none; }

        /* شريط التنقل السفلي */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%;
            background: #1e293b; display: flex;
            justify-content: space-around; padding: 10px 0;
            border-top: 1px solid #334155; z-index: 1000;
        }

        .nav-item {
            color: var(--text-dim); text-decoration: none;
            font-size: 10px; text-align: center; flex: 1;
        }

        .nav-item.active { color: var(--primary); }
        .nav-item svg { width: 22px; height: 22px; display: block; margin: 0 auto 4px; }

        /* شاشة التحميل */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark); display: flex; justify-content: center;
            align-items: center; z-index: 9999;
        }

        /* نمط الفيديوهات والتفسير */
        .full-list-item {
            background: var(--card-bg); margin-bottom: 8px;
            padding: 15px; border-radius: 10px; display: flex; justify-content: space-between;
        }
    </style>
</head>
<body>

<div id="loader"><span>جاري تجهيز التطبيق...</span></div>

<header>
    <h2 id="pageTitle">القرآن الكريم</h2>
    <div class="search-container">
        <input type="text" class="search-input" id="mainSearch" placeholder="ابحث هنا..." oninput="handleSearch(this.value)">
    </div>
</header>

<div class="content-area" id="mainView">
    </div>

<div class="audio-player-fixed" id="playerBar">
    <div class="player-info">
        <div id="trackTitle" style="font-weight: bold;">اسم السورة</div>
        <div id="trackSub">اسم القارئ</div>
    </div>
    <button onclick="toggleAudio()" id="playBtn" style="background:white; border:none; border-radius:50%; width:40px; height:40px;">⏸</button>
    <audio id="mainAudio" controls></audio>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="loadReciters()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        القراء
    </div>
    <div class="nav-item" onclick="loadRadios()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 6H4V4h16v2zm0 4H4v2h16v-2zm0 4H4v2h16v-2zm0 4H4v2h16v-2z"/></svg>
        راديو
    </div>
    <div class="nav-item" onclick="loadTafsir()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5-1.17 0-2.39.15-3.5.5V19c1.11-.35 2.33-.5 3.5-.5 1.95 0 4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0 2.39.15 3.5.5V5z"/></svg>
        تفسير
    </div>
    <div class="nav-item" onclick="loadVideos()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
        مرئيات
    </div>
</nav>

<script>
    const API_URL = "https://mp3quran.net/api/v3";
    const mainView = document.getElementById('mainView');
    const audio = document.getElementById('mainAudio');
    
    let state = {
        reciters: [],
        surahs: [],
        currentMode: 'reciters'
    };

    // التشغيل عند البدء
    window.onload = async () => {
        const surahRes = await fetch(`${API_URL}/suwar`);
        const surahData = await surahRes.json();
        state.surahs = surahData.suwar;
        
        await loadReciters();
        document.getElementById('loader').style.display = 'none';
    };

    // جلب القراء
    async function loadReciters() {
        state.currentMode = 'reciters';
        setActiveNav(0);
        mainView.innerHTML = '<p>جاري تحميل قائمة القراء...</p>';
        const res = await fetch(`${API_URL}/reciters?language=ar`);
        const data = await res.json();
        state.reciters = data.reciters;
        renderReciters(state.reciters);
    }

    function renderReciters(list) {
        let html = '<div class="grid-container">';
        list.forEach(r => {
            html += `
                <div class="item-card" onclick="openReciter('${r.id}')">
                    <div class="item-name">${r.name}</div>
                    <div class="item-sub">${r.moshaf[0].name}</div>
                </div>
            `;
        });
        html += '</div>';
        mainView.innerHTML = html;
    }

    // فتح سور القارئ
    function openReciter(id) {
        const reciter = state.reciters.find(r => r.id == id);
        const moshaf = reciter.moshaf[0];
        const sList = moshaf.surah_list.split(',');
        
        mainView.innerHTML = `<h3>${reciter.name}</h3><div class="grid-container">`;
        sList.forEach(sId => {
            const sName = state.surahs.find(s => s.id == sId).name;
            const audioUrl = `${moshaf.server}${sId.padStart(3, '0')}.mp3`;
            mainView.innerHTML += `
                <div class="item-card" onclick="play('${audioUrl}', '${sName}', '${reciter.name}')">
                    <div class="item-name">${sName}</div>
                    <div class="item-sub">تشغيل الآن</div>
                </div>
            `;
        });
        mainView.innerHTML += '</div>';
    }

    // الإذاعات
    async function loadRadios() {
        state.currentMode = 'radios';
        setActiveNav(1);
        const res = await fetch(`${API_URL}/radios?language=ar`);
        const data = await res.json();
        mainView.innerHTML = '<div class="grid-container">';
        data.radios.forEach(r => {
            mainView.innerHTML += `
                <div class="item-card" onclick="play('${r.url}', '${r.name}', 'راديو مباشر')">
                    <div class="item-name">${r.name}</div>
                </div>
            `;
        });
        mainView.innerHTML += '</div>';
    }

    // التفسير والتدبر
    async function loadTafsir() {
        state.currentMode = 'tafsir';
        setActiveNav(2);
        const res = await fetch(`${API_URL}/tafasir?language=ar`);
        const data = await res.json();
        mainView.innerHTML = '<h3>التفسير الصوتي</h3>';
        data.tafasir.soar.forEach(t => {
            mainView.innerHTML += `
                <div class="full-list-item" onclick="play('${t.url}', '${t.name}', 'تفسير')">
                    <span>${t.name}</span>
                    <small>استماع</small>
                </div>
            `;
        });
    }

    // المرئيات (فيديو)
    async function loadVideos() {
        state.currentMode = 'videos';
        setActiveNav(3);
        const res = await fetch(`${API_URL}/videos?language=ar`);
        const data = await res.json();
        mainView.innerHTML = '<h3>قنوات قرآنية</h3>';
        data.videos.forEach(v => {
            mainView.innerHTML += `
                <div class="item-card" style="width:100%; margin-bottom:15px;">
                    <div class="item-name">${v.reciter_name}</div>
                    <video controls style="width:100%; border-radius:10px; margin-top:10px;">
                        <source src="${v.video_url}" type="video/mp4">
                    </video>
                </div>
            `;
        });
    }

    // نظام البحث
    function handleSearch(val) {
        if(state.currentMode === 'reciters') {
            const filtered = state.reciters.filter(r => r.name.includes(val));
            renderReciters(filtered);
        }
    }

    // مشغل الصوت
    function play(url, title, sub) {
        document.getElementById('playerBar').style.display = 'flex';
        document.getElementById('trackTitle').innerText = title;
        document.getElementById('trackSub').innerText = sub;
        audio.src = url;
        audio.play();
        document.getElementById('playBtn').innerText = '⏸';
    }

    function toggleAudio() {
        if(audio.paused) {
            audio.play();
            document.getElementById('playBtn').innerText = '⏸';
        } else {
            audio.pause();
            document.getElementById('playBtn').innerText = '▶';
        }
    }

    function setActiveNav(idx) {
        document.querySelectorAll('.nav-item').forEach((el, i) => {
            el.classList.toggle('active', i === idx);
        });
    }
</script>

</body>
</html>
